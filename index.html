<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>üåå Galaxy Piano - Musical Universe v1.3.0</title>
    
    <!-- CSS Files -->
    <link rel="stylesheet" href="styles/main.css">
    <link rel="stylesheet" href="styles/galaxy.css">
    <link rel="stylesheet" href="styles/components.css">
    <link rel="stylesheet" href="styles/composer.css">
    
    <!-- External Libraries CDN -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/three.js/r128/three.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/tone/14.8.49/Tone.min.js"></script>
</head>
<body>
    <div id="app">
        <!-- Header -->
        <header class="header">
            <div class="header-content">
                <h1>üåå Galaxy Piano</h1>
                <div class="version-badge">v1.3.0 - Sprint 3</div>
            </div>
            <nav class="nav">
                <button class="nav-btn active" data-mode="live">üéπ Live</button>
                <button class="nav-btn" data-mode="composer">üéº Compositor</button>
                <button class="nav-btn" data-mode="analysis">üìä An√°lisis</button>
            </nav>
        </header>

        <!-- Main Content -->
        <main class="main">
            <!-- Live Mode (Sprint 1 & 2 - Sin cambios) -->
            <section id="live-mode" class="mode-section active">
                <div class="controls-panel">
                    <div class="input-group">
                        <label for="note-input">Nota Musical (1-88):</label>
                        <input 
                            type="text" 
                            id="note-input" 
                            placeholder="Ej: 40 (C4) o 40,43,47"
                            class="note-input"
                        >
                        <button id="play-btn" class="play-btn">üéµ Tocar</button>
                        <button id="stop-btn" class="stop-btn">‚èπÔ∏è Parar</button>
                    </div>
                    
                    <div class="volume-control">
                        <label for="volume">Volumen:</label>
                        <input type="range" id="volume" min="0" max="100" value="50">
                        <span id="volume-display">50%</span>
                    </div>
                </div>

                <!-- Galaxy Canvas -->
                <div class="galaxy-container">
                    <canvas id="galaxy-canvas"></canvas>
                    <div class="loading" id="loading">
                        <div class="loading-spinner"></div>
                        <p>Cargando Universe Musical...</p>
                    </div>
                </div>
            </section>

            <!-- Composer Mode (Sprint 3 - NUEVO) -->
            <section id="composer-mode" class="mode-section">
                <!-- Project Management Panel -->
                <div class="project-panel">
                    <div class="project-header">
                        <h2>üíæ Gesti√≥n de Proyectos</h2>
                        <div class="project-actions">
                            <button id="new-project-btn" class="action-btn new-btn">‚ûï Nuevo</button>
                            <button id="save-project-btn" class="action-btn save-btn">üíæ Guardar</button>
                            <button id="delete-project-btn" class="action-btn delete-btn">üóëÔ∏è Eliminar</button>
                        </div>
                    </div>
                    
                    <div class="project-controls">
                        <div class="project-selector">
                            <label for="project-select">Proyecto Actual:</label>
                            <select id="project-select" class="project-select">
                                <option value="">Seleccionar proyecto...</option>
                            </select>
                        </div>
                        
                        <div class="project-metadata">
                            <div class="metadata-field">
                                <label for="project-name">Nombre:</label>
                                <input type="text" id="project-name" class="metadata-input" placeholder="Nombre del proyecto">
                            </div>
                            <div class="metadata-field">
                                <label for="project-description">Descripci√≥n:</label>
                                <textarea id="project-description" class="metadata-textarea" placeholder="Descripci√≥n del proyecto"></textarea>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Musical Sequencer Panel -->
                <div class="sequencer-panel">
                    <div class="sequencer-header">
                        <h2>üéº Secuenciador Musical</h2>
                        <div class="sequencer-controls">
                            <button id="composer-play-btn" class="play-btn-large">‚ñ∂Ô∏è Reproducir</button>
                            <button id="composer-stop-btn" class="stop-btn-large">‚èπÔ∏è Detener</button>
                        </div>
                    </div>
                    
                    <!-- Input Panel -->
                    <div class="composer-input-panel">
                        <div class="input-section">
                            <label for="composer-note-input">Entrada Musical:</label>
                            <input 
                                type="text" 
                                id="composer-note-input" 
                                class="composer-input" 
                                placeholder="Ej: C4+E4+G4@2.0v0.8, Am@1.0, F+A+C@1.5"
                            >
                            <button id="add-sequence-btn" class="add-btn">‚ûï A√±adir</button>
                        </div>
                        
                        <div class="tempo-section">
                            <label for="bpm-slider">Tempo:</label>
                            <input type="range" id="bpm-slider" min="60" max="200" value="120">
                            <span id="bpm-display">120 BPM</span>
                        </div>
                    </div>

                    <!-- Sequencer Grid -->
                    <div class="sequencer-grid-container">
                        <div class="grid-header">
                            <h3>üéõÔ∏è Grid de Secuencias</h3>
                            <div class="grid-controls">
                                <button class="grid-btn clear-btn">üßπ Limpiar</button>
                                <button class="grid-btn loop-btn active">üîÅ Loop</button>
                            </div>
                        </div>
                        <div id="sequencer-grid" class="sequencer-grid">
                            <!-- Se generar√° din√°micamente -->
                            <div class="track-row">
                                <div class="track-label">Track 1</div>
                                <div class="step-container">
                                    <!-- 16 steps por track -->
                                    <div class="step" data-track="0" data-step="0"></div>
                                    <div class="step" data-track="0" data-step="1"></div>
                                    <div class="step" data-track="0" data-step="2"></div>
                                    <div class="step" data-track="0" data-step="3"></div>
                                    <div class="step" data-track="0" data-step="4"></div>
                                    <div class="step" data-track="0" data-step="5"></div>
                                    <div class="step" data-track="0" data-step="6"></div>
                                    <div class="step" data-track="0" data-step="7"></div>
                                    <div class="step" data-track="0" data-step="8"></div>
                                    <div class="step" data-track="0" data-step="9"></div>
                                    <div class="step" data-track="0" data-step="10"></div>
                                    <div class="step" data-track="0" data-step="11"></div>
                                    <div class="step" data-track="0" data-step="12"></div>
                                    <div class="step" data-track="0" data-step="13"></div>
                                    <div class="step" data-track="0" data-step="14"></div>
                                    <div class="step" data-track="0" data-step="15"></div>
                                </div>
                            </div>
                            
                            <div class="track-row">
                                <div class="track-label">Track 2</div>
                                <div class="step-container">
                                    <!-- Repetir para Track 2 -->
                                    <div class="step" data-track="1" data-step="0"></div>
                                    <div class="step" data-track="1" data-step="1"></div>
                                    <div class="step" data-track="1" data-step="2"></div>
                                    <div class="step" data-track="1" data-step="3"></div>
                                    <div class="step" data-track="1" data-step="4"></div>
                                    <div class="step" data-track="1" data-step="5"></div>
                                    <div class="step" data-track="1" data-step="6"></div>
                                    <div class="step" data-track="1" data-step="7"></div>
                                    <div class="step" data-track="1" data-step="8"></div>
                                    <div class="step" data-track="1" data-step="9"></div>
                                    <div class="step" data-track="1" data-step="10"></div>
                                    <div class="step" data-track="1" data-step="11"></div>
                                    <div class="step" data-track="1" data-step="12"></div>
                                    <div class="step" data-track="1" data-step="13"></div>
                                    <div class="step" data-track="1" data-step="14"></div>
                                    <div class="step" data-track="1" data-step="15"></div>
                                </div>
                            </div>
                            
                            <div class="track-row">
                                <div class="track-label">Track 3</div>
                                <div class="step-container">
                                    <!-- Repetir para Track 3 -->
                                    <div class="step" data-track="2" data-step="0"></div>
                                    <div class="step" data-track="2" data-step="1"></div>
                                    <div class="step" data-track="2" data-step="2"></div>
                                    <div class="step" data-track="2" data-step="3"></div>
                                    <div class="step" data-track="2" data-step="4"></div>
                                    <div class="step" data-track="2" data-step="5"></div>
                                    <div class="step" data-track="2" data-step="6"></div>
                                    <div class="step" data-track="2" data-step="7"></div>
                                    <div class="step" data-track="2" data-step="8"></div>
                                    <div class="step" data-track="2" data-step="9"></div>
                                    <div class="step" data-track="2" data-step="10"></div>
                                    <div class="step" data-track="2" data-step="11"></div>
                                    <div class="step" data-track="2" data-step="12"></div>
                                    <div class="step" data-track="2" data-step="13"></div>
                                    <div class="step" data-track="2" data-step="14"></div>
                                    <div class="step" data-track="2" data-step="15"></div>
                                </div>
                            </div>
                            
                            <div class="track-row">
                                <div class="track-label">Track 4</div>
                                <div class="step-container">
                                    <!-- Repetir para Track 4 -->
                                    <div class="step" data-track="3" data-step="0"></div>
                                    <div class="step" data-track="3" data-step="1"></div>
                                    <div class="step" data-track="3" data-step="2"></div>
                                    <div class="step" data-track="3" data-step="3"></div>
                                    <div class="step" data-track="3" data-step="4"></div>
                                    <div class="step" data-track="3" data-step="5"></div>
                                    <div class="step" data-track="3" data-step="6"></div>
                                    <div class="step" data-track="3" data-step="7"></div>
                                    <div class="step" data-track="3" data-step="8"></div>
                                    <div class="step" data-track="3" data-step="9"></div>
                                    <div class="step" data-track="3" data-step="10"></div>
                                    <div class="step" data-track="3" data-step="11"></div>
                                    <div class="step" data-track="3" data-step="12"></div>
                                    <div class="step" data-track="3" data-step="13"></div>
                                    <div class="step" data-track="3" data-step="14"></div>
                                    <div class="step" data-track="3" data-step="15"></div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Music Theory Analysis Panel -->
                <div class="theory-panel">
                    <div class="theory-header">
                        <h2>üéµ An√°lisis Musical</h2>
                    </div>
                    
                    <div class="theory-content">
                        <div class="analysis-section">
                            <div class="analysis-item">
                                <span id="chord-analysis" class="analysis-display">Acorde: ---</span>
                            </div>
                            <div class="analysis-item">
                                <span id="chord-suggestions" class="suggestions-display">Sugerencias: ---</span>
                            </div>
                        </div>
                        
                        <div class="theory-info">
                            <div class="theory-stat">
                                <span class="stat-label">Tonalidad:</span>
                                <span id="current-key" class="stat-value">C Major</span>
                            </div>
                            <div class="theory-stat">
                                <span class="stat-label">Escala:</span>
                                <span id="current-scale" class="stat-value">Mayor</span>
                            </div>
                            <div class="theory-stat">
                                <span class="stat-label">Progresi√≥n:</span>
                                <span id="chord-progression" class="stat-value">I - vi - IV - V</span>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Galaxy Visualization (compartida) -->
                <div class="galaxy-container composer-galaxy">
                    <canvas id="galaxy-canvas-composer"></canvas>
                    <div class="galaxy-controls">
                        <button id="galaxy-reset-btn" class="galaxy-btn">üéØ Reset</button>
                        <button id="galaxy-rotate-btn" class="galaxy-btn active">üîÑ Auto-Rotate</button>
                    </div>
                </div>
            </section>

            <!-- Analysis Mode (Sprint 4 - Placeholder) -->
            <section id="analysis-mode" class="mode-section">
                <div class="analysis-panel">
                    <h2>üìä An√°lisis Musical Avanzado</h2>
                    <div class="analysis-preview">
                        <div class="feature-preview">
                            <h3>üåä Visualizaci√≥n de Ondas 2D</h3>
                            <p>An√°lisis de forma de onda en tiempo real</p>
                        </div>
                        <div class="feature-preview">
                            <h3>üìà Espectro 3D</h3>
                            <p>An√°lisis frecuencial avanzado con FFT</p>
                        </div>
                        <div class="feature-preview">
                            <h3>üìÅ Exportaci√≥n</h3>
                            <p>Guardar como MIDI, MP3 y JSON</p>
                        </div>
                    </div>
                    <div class="coming-soon">
                        <h3>üöÄ Pr√≥ximamente en Sprint 4...</h3>
                        <div class="progress-bar">
                            <div class="progress-fill" style="width: 75%"></div>
                        </div>
                        <p>75% Completado - An√°lisis y Exportaci√≥n</p>
                    </div>
                </div>
            </section>
        </main>

        <!-- Footer (Actualizado) -->
        <footer class="footer">
            <div class="info-panel">
                <div class="note-info">
                    <span id="current-notes">Notas: Ninguna</span>
                    <span id="chord-info">Acorde: ---</span>
                </div>
                <div class="system-info">
                    <span id="audio-status">üîä Audio: Listo</span>
                    <span id="galaxy-status">üåå Galaxy: Cargando...</span>
                    <span id="composer-status">üéº Compositor: Preparando...</span>
                    <span id="project-status">üíæ Proyectos: Iniciando...</span>
                </div>
            </div>
        </footer>
    </div>

    <!-- Help Modal (NUEVO) -->
    <div id="help-modal" class="modal hidden">
        <div class="modal-content">
            <div class="modal-header">
                <h2>üåå Galaxy Piano - Ayuda</h2>
                <button class="modal-close">&times;</button>
            </div>
            <div class="modal-body">
                <div class="help-section">
                    <h3>üéπ Modo Live</h3>
                    <p>Toca notas individuales o acordes usando n√∫meros (1-88) o nombres musicales (C4, Em, etc.)</p>
                    <ul>
                        <li><strong>Nota simple:</strong> 40 (C4)</li>
                        <li><strong>Acorde:</strong> 40,43,47 (C Major)</li>
                        <li><strong>Nombres:</strong> C4,E4,G4</li>
                    </ul>
                </div>
                
                <div class="help-section">
                    <h3>üéº Modo Compositor</h3>
                    <p>Crea secuencias musicales complejas con an√°lisis de acordes en tiempo real.</p>
                    <ul>
                        <li><strong>Formato avanzado:</strong> C4+E4+G4@2.0v0.8</li>
                        <li><strong>@2.0:</strong> Duraci√≥n en beats</li>
                        <li><strong>v0.8:</strong> Velocidad (0.1-1.0)</li>
                        <li><strong>M√∫ltiples acordes:</strong> Separar con comas</li>
                    </ul>
                </div>
                
                <div class="help-section">
                    <h3>üíæ Gesti√≥n de Proyectos</h3>
                    <p>Guarda y organiza tus creaciones musicales.</p>
                    <ul>
                        <li><strong>Auto-guardado:</strong> Cada 30 segundos</li>
                        <li><strong>Backup autom√°tico:</strong> Al eliminar proyectos</li>
                        <li><strong>Exportaci√≥n:</strong> JSON completo</li>
                    </ul>
                </div>
            </div>
        </div>
    </div>

    <!-- =========================================
         SCRIPTS - ORDEN CR√çTICO PARA SPRINT 3
         ========================================= -->
    
    <!-- 1. UTILIDADES Y HELPERS (Fundaci√≥n) -->
    <script src="scripts/utils/helpers.js"></script>
    
    <!-- 2. AUDIO SYSTEM (Sprint 1) -->
    <script src="scripts/audio/noteMapping.js"></script>
    <script src="scripts/audio/audioEngine.js"></script>
    
    <!-- 3. VISUAL SYSTEM (Sprint 2) -->
    <script src="scripts/visual/galaxyRenderer.js"></script>
    <script src="scripts/visual/starSystem.js"></script>
    
    <!-- 4. COMPOSER SYSTEM (Sprint 3) - ¬°ESTOS SON LOS NUEVOS! -->
    <script src="scripts/composer/sequencer.js"></script>
    <script src="scripts/composer/musicTheory.js"></script>
    <script src="scripts/composer/projectManager.js"></script>
    
    <!-- 5. MAIN APPLICATION (Debe ir AL FINAL) -->
    <script src="scripts/main.js"></script>
    
    <!-- Help button functionality -->
    <script>
        // Help modal functionality
        document.addEventListener('DOMContentLoaded', function() {
            // Add help button to header
            const headerContent = document.querySelector('.header-content');
            if (headerContent) {
                const helpButton = document.createElement('button');
                helpButton.className = 'help-btn';
                helpButton.innerHTML = '‚ùì Ayuda';
                helpButton.onclick = () => {
                    const modal = document.getElementById('help-modal');
                    if (modal) modal.classList.remove('hidden');
                };
                headerContent.appendChild(helpButton);
            }
            
            // Close modal functionality
            const closeBtn = document.querySelector('.modal-close');
            if (closeBtn) {
                closeBtn.onclick = () => {
                    const modal = document.getElementById('help-modal');
                    if (modal) modal.classList.add('hidden');
                };
            }
            
            // Close on outside click
            const modal = document.getElementById('help-modal');
            if (modal) {
                modal.onclick = (e) => {
                    if (e.target.id === 'help-modal') {
                        e.target.classList.add('hidden');
                    }
                };
            }
        });
    </script>
</body>
</html>